<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½æ–°èå¿«å ±</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2965/2965879.png">
    <meta name="theme-color" content="#1DB446">
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f2f2f2; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background-color: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; padding-bottom: 20px; }
        
        /* é ‚éƒ¨å°è¦½åˆ— */
        .header { background-color: #fff; padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .title-group h1 { margin: 0; font-size: 1.2rem; color: #888; }
        .title-group .date { font-size: 1.4rem; font-weight: bold; color: #333; margin-top: 5px; }
        
        /* æ§åˆ¶å€ (æ—¥æœŸé¸æ“‡ + èªè¨€åˆ‡æ›) */
        .controls { display: flex; gap: 10px; }
        select { padding: 5px; border-radius: 5px; border: 1px solid #ddd; background: #f9f9f9; font-size: 0.9rem; }
        .lang-btn { padding: 5px 10px; border-radius: 5px; border: 1px solid #1DB446; background: #fff; color: #1DB446; font-size: 0.9rem; cursor: pointer; }
        .lang-btn.active { background: #1DB446; color: #fff; }

        .summary-box { background-color: #f0f8ff; margin: 20px; padding: 15px; border-radius: 10px; border-left: 5px solid #1DB446; }
        .summary-title { color: #1DB446; font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .summary-content { font-size: 1rem; line-height: 1.6; color: #555; white-space: pre-line; }
        
        .section-title { font-size: 1.2rem; font-weight: bold; margin: 20px; color: #333; }
        .news-list { padding: 0 20px; }
        .news-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; text-decoration: none; color: inherit; }
        .news-index { font-size: 1.2rem; font-weight: bold; color: #ccc; margin-right: 15px; min-width: 25px; }
        .news-title { font-size: 1rem; line-height: 1.4; color: #111; flex: 1; }
        #loading { text-align: center; padding: 50px; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading">ğŸ“¡ è³‡æ–™è¼‰å…¥ä¸­...</div>
        <div id="app-content" style="display: none;">
            <div class="header">
                <div class="title-group">
                    <h1 id="page-title">æ¯æ—¥å¿«å ±</h1>
                    <div class="date" id="date-display">--/--</div>
                </div>
                <div class="controls">
                    <select id="history-select" onchange="loadNews(this.value)"></select>
                    <button class="lang-btn" id="lang-toggle" onclick="toggleLang()">EN</button>
                </div>
            </div>

            <div class="summary-box">
                <div class="summary-title">
                    <span id="summary-label">ğŸ¤– AI é‡é»æ‘˜è¦</span>
                </div>
                <div class="summary-content" id="summary-display"></div>
            </div>

            <div class="section-title" id="news-label">ğŸ”¥ ç†±é–€é ­æ¢</div>
            <div class="news-list" id="news-list"></div>
        </div>
    </div>

    <script>
        let currentData = null;
        let currentLang = 'zh'; // é è¨­ä¸­æ–‡

        // 1. åˆå§‹åŒ–ï¼šè¼‰å…¥æ­·å²æ¸…å–®
        fetch('./history.json?t=' + Date.now())
            .then(res => res.ok ? res.json() : [])
            .then(dates => {
                const select = document.getElementById('history-select');
                if (dates.length > 0) {
                    dates.forEach(date => {
                        const option = document.createElement('option');
                        option.value = date + '.json';
                        option.text = date;
                        select.add(option);
                    });
                    // è¼‰å…¥æœ€æ–°ä¸€ç­†
                    loadNews(dates[0] + '.json');
                } else {
                    // è‹¥ç„¡æ­·å²æª”ï¼Œå˜—è©¦è¼‰å…¥ latest_news.json
                    loadNews('latest_news.json');
                }
            });

        // 2. è¼‰å…¥æ–°èè³‡æ–™
        function loadNews(filename) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('app-content').style.display = 'none';

            fetch('./' + filename + '?t=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    currentData = data;
                    renderPage();
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('app-content').style.display = 'block';
                })
                .catch(err => {
                    document.getElementById('loading').innerText = "ç„¡æ³•è®€å–è³‡æ–™";
                });
        }

        // 3. æ¸²æŸ“é é¢ (æ”¯æ´èªè¨€åˆ‡æ›)
        function renderPage() {
            if (!currentData) return;
            
            // æ™‚é–“èˆ‡æ¨™é¡Œ
            document.getElementById('date-display').textContent = currentData.updated_at;
            
            // æ‘˜è¦å…§å®¹
            const summaryText = currentLang === 'zh' ? currentData.summary.zh : currentData.summary.en;
            document.getElementById('summary-display').textContent = summaryText;

            // UI æ–‡å­—åˆ‡æ›
            document.getElementById('page-title').textContent = currentLang === 'zh' ? 'æ¯æ—¥å¿«å ±' : 'Daily News';
            document.getElementById('summary-label').textContent = currentLang === 'zh' ? 'ğŸ¤– AI é‡é»æ‘˜è¦' : 'ğŸ¤– AI Summary';
            document.getElementById('news-label').textContent = currentLang === 'zh' ? 'ğŸ”¥ ç†±é–€é ­æ¢' : 'ğŸ”¥ Top Headlines';
            
            // æŒ‰éˆ•ç‹€æ…‹
            const btn = document.getElementById('lang-toggle');
            btn.textContent = currentLang === 'zh' ? 'EN' : 'ä¸­';
            btn.classList.toggle('active', currentLang === 'en');

            // æ–°èåˆ—è¡¨
            const list = document.getElementById('news-list');
            list.innerHTML = '';
            currentData.news.forEach((item, i) => {
                const a = document.createElement('a');
                a.className = 'news-item'; 
                a.href = item.link; 
                a.target = '_blank';
                a.innerHTML = `<div class="news-index">${i+1}.</div><div class="news-title">${item.title}</div>`;
                list.appendChild(a);
            });
        }

        // 4. åˆ‡æ›èªè¨€
        function toggleLang() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            renderPage();
        }
    </script>
</body>
</html>
